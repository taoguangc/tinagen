---
import { type CollectionEntry, getCollection, render } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import Hero from '../components/blocks/Hero.astro'
import Feature from '../components/blocks/Feature.astro'

export async function getStaticPaths() {
  const pages = await getCollection('pages')
  return pages.map(page => {
    const id = page.id.replace(/\.(md|mdx)$/, '')
    return {
      params: { id },
      props: { page }
    }
  })
}

const { page } = Astro.props
const { title, seo, blocks = [] } = page.data
const { Content } = await render(page)

// 增加详细的调试信息
console.log('Page data:', {
  title,
  hasBlocks: blocks && blocks.length > 0,
  blocksCount: blocks?.length,
  blocks: JSON.stringify(blocks, null, 2)
})
---

<BaseLayout title={seo?.title ?? title} description={seo?.description} image={seo?.image} showHeader={false}>
  <article class='mb-16 sm:mb-24'>
    {/* 添加调试输出 */}
    {blocks?.length === 0 && <div class='text-red-500'>未发现区块</div>}

    {/* 渲染 blocks */}
    {
      blocks?.map(block => {
        console.log('Processing block:', block._template)
        return block._template === 'hero' ? (
          <Hero headline={block.headline} subHeadline={block.subHeadline} text={block.text} />
        ) : block._template === 'feature' ? (
          <Feature items={block.items} />
        ) : null
      })
    }

    <header class='mb-8'>
      <h1 class='text-3xl leading-tight font-serif font-medium sm:text-5xl sm:leading-tight'>{title}</h1>
    </header>
    <div class='max-w-none prose prose-dante sm:prose-lg'>
      <Content />
    </div>
  </article>
</BaseLayout>
