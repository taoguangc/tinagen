---
import { type CollectionEntry, getCollection, render } from 'astro:content'
import BaseLayout from '../layouts/BaseLayout.astro'
import Hero from '../components/blocks/Hero.astro'
import Feature from '../components/blocks/Feature.astro'

export async function getStaticPaths() {
  const pages = await getCollection('pages')
  return pages.map(page => {
    const id = page.id.replace(/\.(md|mdx)$/, '')
    return {
      params: { id },
      props: { page }
    }
  })
}

const { page } = Astro.props
const { title, seo, sections = [] } = page.data
const { Content } = await render(page)

// 调试日志
console.log('Page data:', page.data)
console.log('Sections:', sections)
---

<BaseLayout title={seo?.title ?? title} description={seo?.description} image={seo?.image} showHeader={false}>
  <article class='mb-16 sm:mb-24'>
    {/* 渲染 sections */}
    {
      sections.map(section =>
        section._template === 'hero' ? (
          <Hero headline={section.headline} subHeadline={section.subHeadline} text={section.text} />
        ) : section._template === 'feature' ? (
          <Feature items={section.items} />
        ) : null
      )
    }

    {/* 其他内容保持不变 */}
    <header class='mb-8'>
      <h1 class='text-3xl leading-tight font-serif font-medium sm:text-5xl sm:leading-tight'>{title}</h1>
    </header>
    <div class='max-w-none prose prose-dante sm:prose-lg'>
      <Content />
    </div>
  </article>
</BaseLayout>
